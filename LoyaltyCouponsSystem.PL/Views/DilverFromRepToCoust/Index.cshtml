@using LoyaltyCouponsSystem.BLL.ViewModel.DeliverFormRepToCoust
@model DeliverFromRepToCoustVM

@{
    ViewData["Title"] = "Item Management";
    Layout = "~/Views/Shared/_LayoutCoupon.cshtml";
}



<br />
<div class="container mt-5">
    <div class="text-center mb-4">
        <h1 class="display-5 text-primary"><b>Exchange Permission</b></h1>
        <p class="lead text-secondary">Assign QR Codes with a streamlined and modern interface.</p>
    </div>

    

        <form asp-controller="DilverFromRepTo" asp-action="Upload" id="assignForm" class="shadow-lg p-4 bg-white rounded" enctype="multipart/form-data" method="post">
            <div asp-validation-summary="All" class="text-danger mb-3"></div>
            
            <div>
                <label>Upload Picture:</label>
                <input type="file" name="image" />
            </div>

            <div>
                <label>Search by Name or Code:</label>
                <input type="text" id="searchBox" placeholder="Search..." />
            </div>

            <div id="searchResults"></div>

              <div class="row g-3">
                  <div class="col-md-6">
                      <label for="CustomerCodeOrName" class="form-label"><b>Select Customer</b></label>
                      <select asp-for="SelectedCustomerCode" asp-items="Model.Customers" class="form-control select2" required>
                          <option value="" disabled selected>Select Customer</option>
                          @foreach (var customer in Model.Customers)
                          {
                              <option value="@customer.Value">@customer.Text</option>
                          }
                      </select>
                  </div>

                  <div class="col-md-6">
                      <label for="TechnicianCodeOrName" class="form-label"><b>Select Technician</b></label>
                      <select asp-for="SelectedTechnicianCode" asp-items="Model.Technicians" class="form-control select2" required>
                          <option value="" disabled selected>Select Technician</option>
                          @foreach (var technician in Model.Technicians)
                          {
                              <option value="@technician.Value">@technician.Text</option>
                          }
                      </select>
                  </div>
              </div>
              <div class="row g-3 mt-3">

                   <div class="col-md-6">
                      <label>Governorate:</label>
                      <select id="governorateDropdown" name="Governorate">
                          <option value="">Select Governorate</option>
                          @foreach (var gov in ViewBag.Governorates)
                          {
                              <option value="@gov.Id">@gov.Name</option>
                          }
                      </select>
                  </div> 
                   <div class="col-md-6">
                      <label for="areaDropdown" class="form-label"><b>Select Area</b></label>
                      <select class="form-select" id="areaDropdown" name="Area" required>
                          <option value="">Select Area</option>
                      </select>


                  </div> 
              </div>

              <div class="row g-3 mt-3">
                  <div class="col-md-6">
                      <label for="ExchangePermission" class="form-label"><b>Exchange Permission Number</b></label>
                      <input asp-for="ExchangePermission" name="Transactions[0].ExchangePermission" class="form-control" placeholder="Enter exchange permission number" required />
                      <span id="exchangePermissionError" class="text-danger" style="display: none;"></span>
                  </div>
              </div>




                 <div class="text-center mt-4">
                     <button type="submit" class="btn btn-custom">
                         <i class="fas fa-paper-plane"></i> Assign
                     </button>
                 </div>
        </form>

        
      
       
        
    
</div>




<br />
<br />



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#searchBox').on('input', function () {
            var query = $(this).val();
            $.post('/DilverFromRepToCoust/Search', { query: query }, function (data) {
                $('#searchResults').html(data);
            });
        });

        $('#governorateDropdown').on('change', function () {
            var governorateId = $(this).val();
            $.get('/DilverFromRepToCoust/GetAreas', { governorateId: governorateId }, function (data) {
                var areaDropdown = $('#areaDropdown');
                areaDropdown.empty();
                areaDropdown.append('<option value="">Select Area</option>');
                $.each(data, function (i, area) {
                    areaDropdown.append('<option value="' + area.name + '">' + area.name + '</option>');
                });
            });
        });
    });
</script>





@section Scripts {
    <script>
        









        // Function to validate and check that Exchange Permission Number is unique
                        document.getElementById('assignForm').addEventListener('submit', function (event) {
            const exchangePermissionInput = document.querySelector('[name="Transactions[0].ExchangePermission"]');
            const exchangePermissionError = document.getElementById('exchangePermissionError');
            const exchangePermission = exchangePermissionInput.value;

            $.ajax({
                url: '/ExchangeOrder/CheckExchangePermission', // Ensure this URL is correct
                type: 'POST',
                data: { exchangePermission },
                async: false,
                success: function (isDuplicate) {
                    if (isDuplicate) {
                        event.preventDefault();
                        // Show the error message in red below the field
                        exchangePermissionError.textContent = 'This Exchange Permission Number is already used.';
                        exchangePermissionError.style.display = 'block';
                        exchangePermissionInput.classList.add('is-invalid');
                        exchangePermissionInput.focus();
                    } else {
                        // Hide the error message if no duplicate is found
                        exchangePermissionError.style.display = 'none';
                        exchangePermissionInput.classList.remove('is-invalid');
                    }
                },
                error: function () {
                    event.preventDefault();
                    // Show a generic error message
                    exchangePermissionError.textContent = 'An error occurred while checking the Exchange Permission Number.';
                    exchangePermissionError.style.display = 'block';
                    exchangePermissionInput.classList.add('is-invalid');
                }
            });
        });


                    $(document).ready(function () {
            $('.select2').select2({
                placeholder: "Select an option", // Placeholder text
                allowClear: true,               // Allow clearing selected value
                width: '100%'                   // Ensure dropdown is responsive
            });
        });

    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/additional-methods.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>



    <!-- Include Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
}

<style>
    .form-label {
        color: #007bff !important;
        font-weight: bold;
    }

    .form-control, .form-select {
        border-radius: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        font-size: 14px;
        padding: 10px 15px;
        transition: all 0.3s ease;
    }

        .form-control:focus, .form-select:focus {
            border-color: #0056b3;
            box-shadow: 0 0 10px rgba(0, 86, 179, 0.3);
        }


    label {
        font-weight: bold;
    }


    .btn-outline-secondary {
        border-radius: 30px;
        border: 2px solid #007bff;
        color: #007bff;
        padding: 8px 20px;
        transition: all 0.3s ease;
    }

        .btn-outline-secondary:hover {
            background-color: #007bff;
            color: white;
        }

    .btn-custom {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 8px 20px;
        background-color: #007bff;
        color: #fff;
        font-weight: bold;
        font-size: 14px;
        border: none;
        border-radius: 25px;
        box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

        .btn-custom:hover {
            background-color: #0056b3;
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 86, 179, 0.3);
        }

        .btn-custom:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

    .btn-danger {
        border-radius: 20px;
    }

    .couponFields {
        border-bottom: 1px dashed #e0e0e0;
        padding-bottom: 15px;
        margin-bottom: 10px;
    }

    .container h1 {
        font-size: 28px;
        font-weight: bold;
    }

    .is-invalid {
        border-color: #dc3545; /* Red border */
        box-shadow: 0 0 5px rgba(220, 53, 69, 0.5); /* Optional red shadow */
    }

    .text-danger {
        font-size: 0.875em; /* Adjust font size if needed */
        margin-top: 5px;
    }

    .select2-container .select2-selection--single {
        height: 38px; /* Adjust height to match `form-select` */
        border-radius: 8px;
        border: 1px solid #ced4da; /* Match other field borders */
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 38px;
        color: #495057;
        padding-left: 8px; /* Align with other fields */
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 38px;
    }

    hr {
        border-top: 2px solid #808080;
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .sequence-error {
        margin-top: 5px;
        font-size: 0.875em;
        color: #dc3545;
        position: relative;
    }

</style>