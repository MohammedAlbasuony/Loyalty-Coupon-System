@using LoyaltyCouponsSystem.BLL.ViewModel.QRCode
@model QRCodeDetailsViewModel
@{
    ViewData["Title"] = "QR Code Generator";


}

<div class="container mt-5">
    <div style="direction: rtl; text-align: right;">
        <h2>انشاء باركود</h2>
    </div>

    <form asp-controller="GenerateQRCode" asp-action="DetailsOfCoupones" method="post">

        <div class="container">


            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="value">اختر نوع الكوبون:</label>
                <select asp-for="TypeOfCoupon" class="form-select" aria-label="Default select example">
                    <option selected>اختر نوع الكوبون</option>
                    <option value="راك ثيرم">راك ثيرم</option>
                    <option value="صرف جي تكس">صرف جي تكس</option>
                    <option value="اقطار كبيرة وهودذا">اقطار كبيرة وهودذا</option>
                    <option selected>اختر نوع كعب الاختبار</option>
                    <option value="كعب راك ثيرم">كعب راك ثيرم</option>
                    <option value="كعب صرف جي تكس">كعب صرف جي تكس</option>
                    <option value="كعب اقطار كبيرة وهودذا">كعب اقطار كبيرة وهودذا</option>
                </select>
            </div>

          

            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="value">القيمه:</label>
                <input type="number" class="form-control" id="value" name="Value" value="50" min="1" />
            </div>


            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label asp-for="GovernorateId" class="form-label">اختر المحافظه (اختياري):</label>
                <select class="form-select" aria-label="Default select example" asp-for="GovernorateId" asp-items="@(new SelectList(Model.governorates,"Id","Name"))">
                    <option selected>اختر المحافظه </option>

                </select>


            </div>


            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label asp-for="AreaId" class="form-label">اختر المنطقه (اختياري):</label>
                <select class="form-select" aria-label="Default select example" asp-for="AreaId" asp-items="@(new SelectList(Model.Areas,"Id","Name"))">
                    <option selected>اختر المنطقه </option>

                </select>


            </div>


            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="Count" class="form-label">اختر العدد:</label>
                <input type="number" class="form-control" id="Count" name="Count" required>
            </div>

            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="SerialNumber" class="form-label">مسلسل الكوبون:</label>
                <input type="number" class="form-control" id="SerialNumber" name="Serialnumber" required>
            </div>

            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="couponsPerRow">Coupons Per Row:</label>
                <input type="number"  class="form-control" id="couponsPerRow" name="CouponsPerRow" value="5" min="1" />
            </div>
            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="horizontalSpacing">المسافه الافقيه بين الكوبونات (cm):</label>
                <input type="number" step="0.1" class="form-control" id="horizontalSpacing" name="HorizontalSpacing" value="0.5" />
            </div>
            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="verticalSpacing">المسافه الرأسيه بين الكوبونات (cm):</label>
                <input type="number" step="0.1" class="form-control" id="verticalSpacing" name="VerticalSpacing" value="1" />
            </div>
            <div class="mb-3" style="direction: rtl; text-align: right;">
                <label for="couponWidth">حجم الكوبون (cm):</label>
                <input type="number" step="0.1" class="form-control" id="couponWidth" name="CouponSize" value="2.5" />
            </div>
            

            <div class="mb-4" style="direction: rtl; text-align: right;">
                <button type="submit" class="btn btn-primary">انشاء الكوبونات </button>

            </div>

        </div>

    </form>

    @section Scripts {
        <script>
            $(document).ready(function () {
                let maxSerialNumber = 0;

                // Fetch the maximum serial number from the server
                $.get("/GenerateQRCode/GetMaxSerialNumber", function (data) {
                    maxSerialNumber = data;
                });

                // Validate the serial number on blur
                $("#SerialNumber").on("blur", function () {
                    const enteredSerial = parseInt($(this).val());
                    if (!isNaN(enteredSerial) && enteredSerial <= maxSerialNumber) {
                        // Show an error message below the input field
                        if (!$("#serialNumberError").length) {
                            $("#SerialNumber").after('<span id="serialNumberError" style="color: red;">الرقم المدخل أقل من أعلى رقم مسلسل (' + maxSerialNumber + '). يرجى إدخال رقم أكبر.</span>');
                        }
                    } else {
                        // Remove the error message if the input is valid
                        $("#serialNumberError").remove();
                    }
                });

                // Handle governorate and area changes
                $('#GovernorateId').change(function () {
                    var GovernorateId = $(this).val();
                    var AreaList = $('#AreaId');

                    AreaList.empty();
                    AreaList.append('<option>اختر المنطقة</option>');
                    if (GovernorateId !== '') {
                        $.ajax({
                            url: '/GenerateQRCode/GetAreas?GovernorateId=' + GovernorateId,
                            success: function (areas) {
                                $.each(areas, function (i, area) {
                                    AreaList.append($('<option></option>').attr('value', area.id).text(area.name));
                                });
                            },
                            error: function () {
                                alert('حدث خطأ أثناء تحميل المناطق.');
                            }
                        });
                    }
                });
            });
        </script>
    }




</div>